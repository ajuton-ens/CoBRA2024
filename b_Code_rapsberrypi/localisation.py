import math
from centrale_inirtielle import mesure_angles
from tf_luna import mesure_distance
from XY4 import Localisation
from picamera2 import Picamera2
import time
"""
listePoints3D = {93:(2.5, 2, 0) ,95:(3, 2.5,0),96:(2.5,3,0),97:(2, 2.5,0),84: (0.0, 14.0, 0.0), 85: (1.0, 14.0, 0.0), 86: (2.0, 14.0, 0.0), 87: (3.0, 14.0, 0.0), 88: (4.0, 14.0, 0.0), 89: (5.0, 14.0, 0.0),
                                78: (0.0, 13.0, 0.0), 79: (1.0, 13.0, 0.0), 80: (2.0, 13.0, 0.0), 81: (3.0, 13.0, 0.0), 82: (4.0, 13.0, 0.0), 83: (5.0, 13.0, 0.0),
                                72: (0.0, 12.0, 0.0), 73: (1.0, 12.0, 0.0), 74: (2.0, 12.0, 0.0), 75: (3.0, 12.0, 0.0), 76: (4.0, 12.0, 0.0), 77: (5.0, 12.0, 0.0),
                                66: (0.0, 11.0, 0.0), 67: (1.0, 11.0, 0.0), 68: (2.0, 11.0, 0.0), 69: (3.0, 11.0, 0.0), 70: (4.0, 11.0, 0.0), 71: (5.0, 11.0, 0.0),
                                60: (0.0, 10.0, 0.0), 61: (1.0, 10.0, 0.0), 62: (2.0, 10.0, 0.0), 63: (3.0, 10.0, 0.0), 64: (4.0, 10.0, 0.0), 65: (5.0, 10.0, 0.0),
                                54: (0.0, 9.0, 0.0), 55: (1.0, 9.0, 0.0), 56: (2.0, 9.0, 0.0), 57: (3.0, 9.0, 0.0), 58: (4.0, 9.0, 0.0), 59: (5.0, 9.0, 0.0),
                                48: (0.0, 8.0, 0.0), 49: (1.0, 8.0, 0.0), 50: (2.0, 8.0, 0.0), 51: (3.0, 8.0, 0.0), 52: (4.0, 8.0, 0.0), 53: (5.0, 8.0, 0.0),
                                42: (0.0, 7.0, 0.0), 43: (1.0, 7.0, 0.0), 44: (2.0, 7.0, 0.0), 45: (3.0, 7.0, 0.0), 46: (4.0, 7.0, 0.0), 47: (5.0, 7.0, 0.0),
                                36: (0.0, 6.0, 0.0), 37: (1.0, 6.0, 0.0), 38: (2.0, 6.0, 0.0), 39: (3.0, 6.0, 0.0), 40: (4.0, 6.0, 0.0), 41: (5.0, 6.0, 0.0),
                                30: (0.0, 5.0, 0.0), 31: (1.0, 5.0, 0.0), 32: (2.0, 5.0, 0.0), 33: (3.0, 5.0, 0.0), 34: (4.0, 5.0, 0.0), 35: (5.0, 5.0, 0.0),
                                24: (0.0, 4.0, 0.0), 25: (1.0, 4.0, 0.0), 26: (2.0, 4.0, 0.0), 27: (3.0, 4.0, 0.0), 28: (4.0, 4.0, 0.0), 29: (5.0, 4.0, 0.0),
                                18: (0.0, 3.0, 0.0), 19: (1.0, 3.0, 0.0), 20: (2.0, 3.0, 0.0), 21: (3.0, 3.0, 0.0), 22: (4.0, 3.0, 0.0), 23: (5.0, 3.0, 0.0),
                                12: (0.0, 2.0, 0.0), 13: (1.0, 2.0, 0.0), 14: (2.0, 2.0, 0.0), 15: (3.0, 2.0, 0.0), 16: (4.0, 2.0, 0.0), 17: (5.0, 2.0, 0.0),
                                6:  (0.0, 1.0, 0.0),  7: (1.0, 1.0, 0.0),  8: (2.0, 1.0, 0.0),  9: (3.0, 1.0, 0.0), 10: (4.0, 1.0, 0.0), 11: (5.0, 1.0, 0.0),
                                0:  (0.0, 0.0, 0.0),  1: (1.0, 0.0, 0.0),  2: (2.0, 0.0, 0.0),  3: (3.0, 0.0, 0.0),  4: (4.0, 0.0, 0.0),  5: (5.0, 0.0, 0.0)
                              }
"""
listePoints3D = {               30: (2.0, 6.0, 0.0), 31: (3.0, 6.0, 0.0), 32: (4.0, 6.0, 0.0), 33: (5.0, 6.0, 0.0), 34: (6.0, 6.0, 0.0),
                                24: (3.0, 4.5, 0.0), 25: (4.0, 4.5, 0.0), 26: (5.0, 4.5, 0.0), 27: (6.0, 4.5, 0.0), 28: (0.0, 6.0, 0.0), 29: (1.0, 6.0, 0.0),
                                18: (4.0, 3.0, 0.0), 19: (5.0, 3.0, 0.0), 20: (6.0, 3.0, 0.0), 21: (0.0, 4.5, 0.0), 22: (1.0, 4.5, 0.0), 23: (2.0, 4.5, 0.0),
                                12: (5.0, 1.5, 0.0), 13: (6.0, 1.5, 0.0), 14: (0.0, 3.0, 0.0), 15: (1.0, 3.0, 0.0), 16: (2.0, 3.0, 0.0), 17: (3.0, 3.0, 0.0),
                                6:  (6.0, 0.0, 0.0),  7: (0.0, 1.5, 0.0),  8: (1.0, 1.5, 0.0),  9: (2.0, 1.0, 0.0), 10: (3.0, 1.5, 0.0), 11: (4.0, 1.5, 0.0),
                                0:  (0.0, 0.0, 0.0),  1: (1.0, 0.0, 0.0),  2: (2.0, 0.0, 0.0),  3: (3.0, 0.0, 0.0),  4: (4.0, 0.0, 0.0),  5: (5.0, 0.0, 0.0)}
tag = Localisation(listePoints3D)

def localiser():
    tangage, roulis, lacet = mesure_angles()
    d = mesure_distance()
    h = d*math.cos(tangage*math.pi/180)*math.cos(roulis*math.pi/180)
    xyl = tag.mesure()
    if xyl is None:
        return ("Aucun tag","Aucun tag",h,tangage,roulis,0)
    else :
      
        x,y,lacet = xyl
        
        offset = 180# Calibration au début de chaque test
        lacet = lacet + offset
        
        
        return(x,y,h,tangage,roulis,lacet)
       # print(x,y)
    #return (tangage,roulis,lacet)
    #return(h,d)
def localiserSansTelemetre():
    tangage, roulis, lacet = mesure_angles()
    xyhl = tag.mesureSansTelemetre()
    if xyhl is None:
        return ("Aucun tag","Aucun tag","Aucun tag",tangage,roulis,0)
    else :
      
        x,y,h,lacet = xyhl
        
        offset = 180# Calibration au début de chaque test
        lacet = lacet + offset
        
        
        return(x,y,h*100,tangage,roulis,lacet) #h est en cm !!!!! :-(
       # print(x,y)
    #return (tangage,roulis,lacet)
    #return(h,d)
    
if __name__ == '__main__':
    while (1):
        print(localiser()[0],localiser()[1],localiser()[2])
        #time.sleep(1)